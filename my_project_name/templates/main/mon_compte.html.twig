{% extends 'base.html.twig' %}

{% block title %}Profil | {{user.name}} {{user.lastname}}{% endblock %}

{% block body %}
    <div>
        <h1 class="text-center py-5" id="titre">{{user.name}} {{user.lastname}} -
            {% if user.commission >= 600 %}
                <span class="badge badge-pill badge-success">4</span>
            {% elseif user.commission >= 400 %}
                <span class="badge badge-pill badge-secondary">3</span>
            {% elseif user.commission >= 200 %}
                <span class="badge badge-pill badge-info">2</span>
            {% elseif user.commission >= 100 %}
                <span class="badge badge-pill badge-warning">1</span>
            {% else %}
                <span class="badge badge-pill badge-primary">0</span>
            {% endif %}
        </h1>
        <div class="row">
            <div class="col-md-4">
                {% if user.avatar %}
                        <img src="{{ asset('images/'~user.avatar)}}" alt="avatar"class="w-75 d-flex mx-auto rounded-circle">
                {% else %}
                        <img src="{{ asset('images/imageDefault.jpg')}}" alt="avatar"class="img-thumbnail" >
                {% endif %}
            </div>
            <div class="col-md-8">
                {# description #}
                <p>{{ user.description | nl2br }}</p>
                {% if liens|length %}
                    <p class="mb-0">Liens utiles:</p>
                    {% for lien in liens %}
                            <a href="{{lien.liens}}" target="blank">{{lien.liens}}</a><br>
                                {% if app.user and app.user.id == user.id %}
                                    <a href="{{path('mon_compte', { id: app.user.id, id_lien: lien.id, action: 'delete-lien' })}}" class="text-danger">Supprimer</a><br>
                                {% endif %}
                    {% endfor %}
                {% endif %}  
                
                <p class="mt-3"><i>Profil mis √† jour le {{user.updatedAt | date('d M Y')}} √† {{user.updatedAt | date('H:i')}} {% if user.vues == 0 %} Je n'ai pas de vue {% else %} profil vu {{ user.vues }} fois {% endif %}</i></p>
                
                <p>{% include 'shared/etoile.html.twig' with { note: moyenne } %}({{ user.avis|length }})</p>
                
                {% if app.user and app.user.id == user.id %}
                    <a href="{{ path('modif_compte', {id: app.user.id}) }}" class="btn btn-outline-primary">Modifier mon profil</a>
                {% endif %}
                {% if app.user and app.user.id != user.id %}
                    <a href="{{ path('contact-profil', {id: user.id}) }}"     class="btn btn-primary" >Me contacter</a>
                {% endif %}    
            </div>

            {% if app.user and app.user.id != user.id %}
                <a href="{{ path('signalement', { id: user.id, cible: 'user'}) }}" class="text-danger ml-auto">Signaler cet utilisateur</a>
            {% endif %}
        </div>
        <hr>
        <div>
            {% if app.user and app.user.id == user.id %}
                <div class="rounded shadow bg-light p-3">
                    <h3>Ajouter une r√©alisation</h3>
            {# ajouter realisation #}
                    {{form(form)}}    
                </div> 
            {% endif %}
            {# liste realisation #}
            <h2 class="mt-5">Mes derni√®res r√©alisations:</h2>
            {% if portfolios|length %}
                <div class="row d-flex flex-wrap ml-5">
                    {% for portfolio in portfolios %}
                        <div class="card p-3 m-3" style="width: 18rem">
                            {% if app.user and app.user.id == user.id %}    
                                <a href="{{path('mon_compte', { id: app.user.id, id_img: portfolio.id, action: 'delete-img' })}} "
                            class="ml-auto mr-3 text-danger">Supprimer</a>
                            {% endif %}
                            <a href="{{path('image', {id: portfolio.id})}}" >
                                <div class="card" id="image_portfolio">
                                    <img class="card-img-top"  src="{{ asset('images/'~portfolio.imgUrl)}}" >
                                </div>
                            </a>   
                        </div>
                    {% endfor %}        
                </div><!--fin card-->
                <a href="{{path('portfolio', {id: user.id})}}">Voir tout le portfolio <i class="far fa-arrow-alt-circle-right"></i></a>  
            {% else %}
                <p>Je n'ai pas encore de portfolio j'y travaille üòé</p>
            {% endif %} 
            <hr>
        </div>
        <div>
            {% if app.user and app.user.id != user.id %}  
                <h2 class="mt-5">Mes annonces:</h2>
				{# liste annonces #}
                {% if annonces|length %}
					{% for annonce in annonces | slice(0,5) | sort((a, b) => b.dateCreation | date("d M Y") <=> a.dateCreation | date("d M Y")) %}
						<article class="border rounded shadow my-3 p-2 bg-light">
							<div class="row">
								<div class="col-md-7">
									<i>Annonce cr√©√©e le
										{{annonce.dateCreation | date('d M Y')}}
										√†
										{{annonce.dateCreation | date('H:i')}}
										par
										{{annonce.user.name}}
                                        {{annonce.user.lastname}}
                                    </i>
								</div>
							</div>
                            <div class="row">
                                <a href="{{path("annonce", {id: annonce.id})}}">
                                    <h3 class="ml-3">{{annonce.titre}}</h3>
                                </a>
                            </div>
                            <p class="  ml-3">{{annonce.description}}</p>
                        </article>
                    {% endfor %}
                {% else %}
                <p> Je n'ai pas encore d'annonce, mais j'y r√©fl√©chis ü§î</p>
                {% endif %}
            <hr>
            {% endif %}
            <h2 class="mt-5">Les avis:</h2>
            {# liste avis #}
            <div class="mt-3 ">
                {% if avis|length %}
                    {% for avi in avis | slice(0,5) %}
                        <div class="border rounded p-3 mb-3">
                            <p class="h6">Commentaire publi√©e par {{ avi.nom }} {{ avi.prenom }} le {{avi.createAt | date('d M Y') }}</p>
                            <div class="text-justify">{{ avi.contenu|nl2br }}</div>
                            <p>
                                {% include 'shared/etoile.html.twig' with { note: avi.note } %}
                            </p>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>Je n'ai pas encore d'avis. Laisse moi en un  üòò</p>
                {% endif %}
            </div>
            {# soumission avis #}
            {% if app.user and app.user.id != user.id %}    
                <div class="mt-4">
                    <form method="post">
                        <div class="form-group presetUserCurrent">
                            <label for="nom">Nom</label>
                            <input type="text" class="form-control"  name="nom" aria-describedby="nomHelp" value="{{ app.user.lastname }}">
                        </div>
                        <div class="form-group presetUserCurrent">
                            <label for="prenom">Pr√©nom</label>
                            <input type="text" class="form-control"  name="prenom" aria-describedby="prenomHelp" value="{{ app.user.name }}">
                        </div>
                        <div class="form-group">
                            <label for="contenu">avis</label>
                            <textarea class="form-control" id="contenu" name="contenu" rows="10"></textarea>
                        </div>
                        <div class="form-group">
                            <select name="note" class="custom-select">
                                <option selected="">Mettre une note</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <input type="checkbox" name="rgpd" aria-label="Checkbox for following text input">
                            <label for="rgpd">J'accepte que mes informations soient stock√©es dans la base de donn√©es pour la gestion des commentaires. J'ai bien not√© qu'en aucun cas ces donn√©es ne seront c√©d√©es √† des tiers.</label>
                        </div>
                        <div class="text-right mt-4">
                            <button type="submit" class="btn btn-primary">Envoyer l'avis</button>
                        </div>
                    </form>
                </div><!--fin form avis-->
            {% endif %}
        </div>
    </div>
{% endblock %}
